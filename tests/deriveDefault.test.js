import { deriveDefaultControlsValue } from "../src";

describe("derive default", () => {
  it("1. works with multiple entities", () => {
    const defaults = deriveDefaultControlsValue([
      {
        id: "f98de0d8-a1a6-4805-97d8-daedef2e95d8",
        type: "date",
        required: true,
        attribute: "b92832b6-cae3-41aa-852d-d356690f2878",
        label: "the date of assessment",
        labelDisplay: "automatic",
        default: "2024-07-01",
        allowManual: true,
        showExplanation: false,
        value: "2024-07-01",
      },
      {
        id: "798f9109-9feb-4486-980c-7ee07194dad9",
        type: "entity",
        template: [
          {
            id: "3bdbe12a-9de1-459e-90d3-f63194acc94b",
            type: "typography",
            text: "Annual salary and allowance amounts:",
            style: "body1",
          },
          {
            id: "e9e2030f-2bf7-472d-a08f-d41b6dd537c4",
            type: "text",
            required: true,
            attribute: "0f8ab8d3-a6bf-4b5f-b37e-16f256429ee0",
            label: "Base salary",
            labelDisplay: "inline",
            showExplanation: false,
          },
          {
            id: "2ca8bd3f-3e78-4e93-8f88-95128311a146",
            type: "text",
            required: true,
            attribute: "e78ab67f-19d6-4391-9772-a09c605acf2a",
            label: "Electorate allowance",
            labelDisplay: "inline",
            showExplanation: false,
          },
          {
            id: "12146ba0-da17-47ad-a54f-a9e7376b4329",
            type: "text",
            required: true,
            attribute: "398b13c9-f641-4eed-91a9-974a1cd11be2",
            label: "Office holder's salary",
            labelDisplay: "inline",
            showExplanation: false,
          },
          {
            id: "726a21d0-0630-4f51-b16b-342b91c2f368",
            type: "text",
            required: true,
            attribute: "8e32f448-7d52-4e03-a3ce-6f072cdb89e7",
            label: "Vehicle allowance",
            labelDisplay: "inline",
            showExplanation: false,
          },
          {
            id: "a8cdd956-23f2-4075-bd10-bb81babc07bd",
            type: "typography",
            text: "Excluded amounts:",
            style: "body1",
          },
          {
            id: "0361728a-773c-4200-8708-71837236cfbb",
            type: "text",
            required: true,
            attribute: "c49f4d0b-8138-4298-9801-a7a4ba4543d7",
            label: "Excluded portion of base salary",
            labelDisplay: "inline",
            showExplanation: false,
          },
          {
            id: "7114396a-fc3a-4578-9e72-fdaad04b15cc",
            type: "text",
            required: true,
            attribute: "eff959c5-eb38-489a-964d-618bfe51c9f6",
            label: "Excluded portion of office holder's salary",
            labelDisplay: "inline",
            showExplanation: false,
          },
          {
            id: "9711daee-25be-4309-aaf7-2b526dd950de",
            type: "typography",
            text: "Whole/part fortnight:",
            style: "body1",
          },
          {
            id: "7787435d-44be-463d-9760-cbcf2cbc88e5",
            type: "boolean",
            required: true,
            showExplanation: false,
            attribute: "ff0163f0-05b9-4c43-ac3b-509c9875f6c5",
            label: "Salary and allowance for the whole fortnight",
            labelDisplay: "inline",
            default: true,
            value: true,
          },
          {
            id: "43245c27-7baa-425a-adef-d961a002ae2f",
            createdAt: 1719278029733,
            version: 2,
            kind: "dynamic",
            type: "switch_container",
            attribute: "people/@id/ff0163f0-05b9-4c43-ac3b-509c9875f6c5",
            outcome_false: [
              {
                id: "dc019d8a-4b49-4de6-b5c1-bdcb34a52ea3",
                type: "text",
                attribute: "585a664a-e425-4ebe-ab92-5b20f0707f2e",
                label: "Number of days in the part of the fortnight",
                labelDisplay: "inline",
                showExplanation: false,
              },
            ],
            dynamicAttributes: ["people/@id/ff0163f0-05b9-4c43-ac3b-509c9875f6c5"],
            branch: "true",
          },
        ],
        label: "people",
        labelDisplay: "automatic",
        display: "vertical",
        entity: "people",
        min: 1,
        value: [],
        instances: [
          {
            id: "69670ad4-fb8b-4d97-b845-5304847b436a",
            controls: [
              {
                id: "3bdbe12a-9de1-459e-90d3-f63194acc94b",
                type: "typography",
                text: "Annual salary and allowance amounts:",
                style: "body1",
                templateText: "Annual salary and allowance amounts:",
                dynamicAttributes: [],
              },
              {
                id: "e9e2030f-2bf7-472d-a08f-d41b6dd537c4",
                type: "text",
                required: true,
                attribute: "0f8ab8d3-a6bf-4b5f-b37e-16f256429ee0",
                label: "Base salary",
                labelDisplay: "inline",
                showExplanation: false,
                templateLabel: "Base salary",
                dynamicAttributes: [],
              },
              {
                id: "2ca8bd3f-3e78-4e93-8f88-95128311a146",
                type: "text",
                required: true,
                attribute: "e78ab67f-19d6-4391-9772-a09c605acf2a",
                label: "Electorate allowance",
                labelDisplay: "inline",
                showExplanation: false,
                templateLabel: "Electorate allowance",
                dynamicAttributes: [],
              },
              {
                id: "12146ba0-da17-47ad-a54f-a9e7376b4329",
                type: "text",
                required: true,
                attribute: "398b13c9-f641-4eed-91a9-974a1cd11be2",
                label: "Office holder's salary",
                labelDisplay: "inline",
                showExplanation: false,
                templateLabel: "Office holder's salary",
                dynamicAttributes: [],
              },
              {
                id: "726a21d0-0630-4f51-b16b-342b91c2f368",
                type: "text",
                required: true,
                attribute: "8e32f448-7d52-4e03-a3ce-6f072cdb89e7",
                label: "Vehicle allowance",
                labelDisplay: "inline",
                showExplanation: false,
                templateLabel: "Vehicle allowance",
                dynamicAttributes: [],
              },
              {
                id: "a8cdd956-23f2-4075-bd10-bb81babc07bd",
                type: "typography",
                text: "Excluded amounts:",
                style: "body1",
                templateText: "Excluded amounts:",
                dynamicAttributes: [],
              },
              {
                id: "0361728a-773c-4200-8708-71837236cfbb",
                type: "text",
                required: true,
                attribute: "c49f4d0b-8138-4298-9801-a7a4ba4543d7",
                label: "Excluded portion of base salary",
                labelDisplay: "inline",
                showExplanation: false,
                templateLabel: "Excluded portion of base salary",
                dynamicAttributes: [],
              },
              {
                id: "7114396a-fc3a-4578-9e72-fdaad04b15cc",
                type: "text",
                required: true,
                attribute: "eff959c5-eb38-489a-964d-618bfe51c9f6",
                label: "Excluded portion of office holder's salary",
                labelDisplay: "inline",
                showExplanation: false,
                templateLabel: "Excluded portion of office holder's salary",
                dynamicAttributes: [],
              },
              {
                id: "9711daee-25be-4309-aaf7-2b526dd950de",
                type: "typography",
                text: "Whole/part fortnight:",
                style: "body1",
                templateText: "Whole/part fortnight:",
                dynamicAttributes: [],
              },
              {
                id: "7787435d-44be-463d-9760-cbcf2cbc88e5",
                type: "boolean",
                required: true,
                showExplanation: false,
                attribute: "ff0163f0-05b9-4c43-ac3b-509c9875f6c5",
                label: "Salary and allowance for the whole fortnight",
                labelDisplay: "inline",
                default: true,
                value: true,
                templateLabel: "Salary and allowance for the whole fortnight",
                dynamicAttributes: [],
              },
              {
                id: "43245c27-7baa-425a-adef-d961a002ae2f",
                createdAt: 1719278029733,
                version: 2,
                kind: "dynamic",
                type: "switch_container",
                attribute: "people/69670ad4-fb8b-4d97-b845-5304847b436a/ff0163f0-05b9-4c43-ac3b-509c9875f6c5",
                outcome_false: [
                  {
                    id: "dc019d8a-4b49-4de6-b5c1-bdcb34a52ea3",
                    type: "text",
                    attribute: "585a664a-e425-4ebe-ab92-5b20f0707f2e",
                    label: "Number of days in the part of the fortnight",
                    labelDisplay: "inline",
                    showExplanation: false,
                    templateLabel: "Number of days in the part of the fortnight",
                    dynamicAttributes: [],
                  },
                ],
                dynamicAttributes: ["people/69670ad4-fb8b-4d97-b845-5304847b436a/ff0163f0-05b9-4c43-ac3b-509c9875f6c5"],
                branch: "true",
              },
            ],
          },
        ],
      },
    ]);

    expect(defaults).toEqual({
      "b92832b6-cae3-41aa-852d-d356690f2878": "2024-07-01",
      people: [
        {
          "@id": "69670ad4-fb8b-4d97-b845-5304847b436a",
          "0f8ab8d3-a6bf-4b5f-b37e-16f256429ee0": undefined,
          "e78ab67f-19d6-4391-9772-a09c605acf2a": undefined,
          "398b13c9-f641-4eed-91a9-974a1cd11be2": undefined,
          "8e32f448-7d52-4e03-a3ce-6f072cdb89e7": undefined,
          "c49f4d0b-8138-4298-9801-a7a4ba4543d7": undefined,
          "eff959c5-eb38-489a-964d-618bfe51c9f6": undefined,
          "ff0163f0-05b9-4c43-ac3b-509c9875f6c5": true,
        },
      ],
    });
  });
});
